#!/usr/bin/env ruby
require 'rubygems'
gem 'gtk2applib', '~> 2.4.0'
require 'gtk2applib/gtk2_app'

# The About info
about = {
	:authors	=> ['carlosjhr64@gmail.com'],
        'comments'      => 'Ruby-Gtk2 Diary',
        'website'       => 'http://ruby-gnome-apps.blogspot.com/search/label/Diary',
        'website-label' => 'Ruby-Gnome Diary',
	:license	=> 'GPL',
	:copyright	=> '2009-Aug-28',
	}

# Miscellaneous info on this application/file
application = {
	:name		=> 'Ruby-Gnome Diary',
	:tooltip	=> 'Diary',
	:FILE		=> __FILE__,
	}

Gtk2App.instance(application, about) do |window|
  UserSpace.mkdir('/diary')
  require 'gtk2diaryapp/gtk2diaryapp'
  Gtk2DiaryApp.new(window)
end

if Configuration::DAYS_TO_HOLD_BAK then
  require 'find'
  now = Time.now.to_i
  spd = 60*60*24
  Find.find(Configuration::DIARY_DIRECTORY){|fn|
    if fn=~/\.txt\.bak/ then
      days_old = (now - File.mtime(fn).to_i)/spd
      File.unlink(fn) if days_old > Configuration::DAYS_TO_HOLD_BAK
    end
  }
end
