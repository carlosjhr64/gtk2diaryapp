#!/usr/bin/env ruby
require 'rubygems'
gem 'gtk2applib', '~> 5.0.0'
require 'gtk2applib/gtk2_app'


Gtk2App.init( {
	:name		=> 'Ruby-Gnome Diary',
	:tooltip	=> 'Diary',
	:FILE		=> __FILE__,
	} )

require 'gtk2diaryapp/gtk2diaryapp'

about = {
	:authors	=> ['carlosjhr64@gmail.com'],
        :website       => 'http://ruby-gnome-apps.blogspot.com/search/label/Diary',
        :website_label => 'Ruby-Gnome Diary',
	:license	=> 'GPL',
	:copyright	=> '2010-02-24 10:17:35',
	}
Gtk2App.main_window(about) do |window|
  include Gtk2Diary

  # Create paned windows
  hpaned = Gtk::HPaned.new
  hpaned.position = Configuration::PANE_POSITION
  
  # Control pane
  control_pane = ControlPane.new
  sw_control = Gtk2App::ScrolledWindow.new(control_pane)
  hpaned.add(sw_control)

  # Results pane
  results_pane = ResultsPane.new
  HOOKS[:results_pane] = results_pane
  today = Date.today
  HOOKS[:results_pane].populate( (today-Configuration::LATEST)..today )
  sw_results = Gtk2App::ScrolledWindow.new(results_pane)
  HOOKS[:vscrollbar] = sw_results.vscrollbar
  hpaned.add(sw_results)
  
  window.add(hpaned)
end

Gtk2App.finalize

if Configuration::DAYS_TO_HOLD_BAK then
  require 'find'
  now = Time.now.to_i
  spd = 60*60*24
  Find.find(Configuration::DIARY_DIRECTORY){|fn|
    if fn=~/\.txt\.bak/ then
      days_old = (now - File.mtime(fn).to_i)/spd
      File.unlink(fn) if days_old > Configuration::DAYS_TO_HOLD_BAK
    end
  }
end
